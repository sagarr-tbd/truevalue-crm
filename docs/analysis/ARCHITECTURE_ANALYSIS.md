# ğŸ—ï¸ **TRUEVALUE CRM - COMPLETE ARCHITECTURE ANALYSIS**

---

## **ğŸ“Š VISUAL SYSTEM ARCHITECTURE**

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚            ğŸŒ INTERNET                          â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                                 â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                           ğŸ›¡ï¸  PUBLIC LAYER (DMZ)                             â”ƒ
â”ƒ                                                                               â”ƒ
â”ƒ   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”ƒ
â”ƒ   â”‚              ğŸšª API GATEWAY (Port 8000)                            â”‚     â”ƒ
â”ƒ   â”‚                    [FastAPI + Uvicorn]                             â”‚     â”ƒ
â”ƒ   â”‚                                                                    â”‚     â”ƒ
â”ƒ   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚     â”ƒ
â”ƒ   â”‚  â”‚   JWT    â”‚  â”‚  Rate    â”‚  â”‚   HMAC   â”‚  â”‚   Org    â”‚         â”‚     â”ƒ
â”ƒ   â”‚  â”‚Validationâ”‚  â”‚ Limiter  â”‚  â”‚ Signing  â”‚  â”‚ Validatorâ”‚         â”‚     â”ƒ
â”ƒ   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚     â”ƒ
â”ƒ   â”‚                                                                    â”‚     â”ƒ
â”ƒ   â”‚  Security: 100 req/min, CORS, Request Tracing (X-Request-ID)    â”‚     â”ƒ
â”ƒ   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”ƒ
â”ƒ                                                                               â”ƒ
â”ƒ   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”ƒ
â”ƒ   â”‚          ğŸ” ADMIN PANEL (Port 8010 - Dev Only)                    â”‚     â”ƒ
â”ƒ   â”‚              [Django with 2FA + Brute-force Protection]            â”‚     â”ƒ
â”ƒ   â”‚                                                                    â”‚     â”ƒ
â”ƒ   â”‚  Access: Multi-database admin for ALL services                    â”‚     â”ƒ
â”ƒ   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                                    â”‚
                                    â”‚ HMAC Signed Requests
                                    â”‚ (Gateway Secret)
                                    â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                      ğŸ¢ INTERNAL SERVICE LAYER                                â”ƒ
â”ƒ                        (NO External Access)                                   â”ƒ
â”ƒ                                                                               â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”ƒ
â”ƒ  â”‚  ğŸ” AUTH      â”‚  â”‚  ğŸ›ï¸ ORG       â”‚  â”‚  ğŸ« PERMISSION â”‚  â”‚  ğŸ’³ BILLING  â”‚ â”ƒ
â”ƒ  â”‚   SERVICE     â”‚  â”‚   SERVICE     â”‚  â”‚    SERVICE     â”‚  â”‚   SERVICE    â”‚ â”ƒ
â”ƒ  â”‚  [Django]     â”‚  â”‚  [Django]     â”‚  â”‚   [Django]     â”‚  â”‚  [Django]    â”‚ â”ƒ
â”ƒ  â”‚               â”‚  â”‚               â”‚  â”‚                â”‚  â”‚              â”‚ â”ƒ
â”ƒ  â”‚â€¢ Users        â”‚  â”‚â€¢ Organizationsâ”‚  â”‚â€¢ Roles         â”‚  â”‚â€¢ Plans       â”‚ â”ƒ
â”ƒ  â”‚â€¢ Sessions     â”‚  â”‚â€¢ Members      â”‚  â”‚â€¢ Permissions   â”‚  â”‚â€¢ Subscript.  â”‚ â”ƒ
â”ƒ  â”‚â€¢ MFA/2FA      â”‚  â”‚â€¢ Teams        â”‚  â”‚â€¢ RBAC          â”‚  â”‚â€¢ Payments    â”‚ â”ƒ
â”ƒ  â”‚â€¢ JWT Tokens   â”‚  â”‚â€¢ Invites      â”‚  â”‚â€¢ Policies      â”‚  â”‚â€¢ Invoices    â”‚ â”ƒ
â”ƒ  â”‚â€¢ Pwd Policy   â”‚  â”‚â€¢ Profiles     â”‚  â”‚â€¢ Assignments   â”‚  â”‚â€¢ Usage Track â”‚ â”ƒ
â”ƒ  â”‚               â”‚  â”‚               â”‚  â”‚                â”‚  â”‚              â”‚ â”ƒ
â”ƒ  â”‚  DB: auth_db  â”‚  â”‚ DB: org_db    â”‚  â”‚DB:permission_dbâ”‚  â”‚DB:billing_db â”‚ â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”ƒ
â”ƒ          â”‚                  â”‚                  â”‚                  â”‚          â”ƒ
â”ƒ          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”ƒ
â”ƒ                                    â”‚                                          â”ƒ
â”ƒ                                    â”‚ Kafka Events                             â”ƒ
â”ƒ                                    â–¼                                          â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”ƒ
â”ƒ  â”‚ ğŸ“‹ AUDIT-LOG  â”‚  â”‚ ğŸ“Š ANALYTICS  â”‚         ğŸ”œ Future: CRM, Marketing     â”ƒ
â”ƒ  â”‚   SERVICE     â”‚  â”‚   SERVICE     â”‚                                        â”ƒ
â”ƒ  â”‚  [Django]     â”‚  â”‚  [Python]     â”‚                                        â”ƒ
â”ƒ  â”‚               â”‚  â”‚               â”‚                                        â”ƒ
â”ƒ  â”‚â€¢ Immutable    â”‚  â”‚â€¢ Event Stream â”‚                                        â”ƒ
â”ƒ  â”‚  Audit Logs   â”‚  â”‚â€¢ Metrics      â”‚                                        â”ƒ
â”ƒ  â”‚â€¢ Compliance   â”‚  â”‚â€¢ Dashboards   â”‚                                        â”ƒ
â”ƒ  â”‚               â”‚  â”‚               â”‚                                        â”ƒ
â”ƒ  â”‚ DB: audit_db  â”‚  â”‚ (Kafka        â”‚                                        â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  Consumer)    â”‚                                        â”ƒ
â”ƒ                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                                    â”‚
                                    â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                    ğŸ—ï¸ INFRASTRUCTURE LAYER                                   â”ƒ
â”ƒ                        (Isolated Network)                                     â”ƒ
â”ƒ                                                                               â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”ƒ
â”ƒ  â”‚  ğŸ’¾ POSTGRES â”‚  â”‚   âš¡ REDIS    â”‚  â”‚  ğŸ“¨ KAFKA    â”‚  â”‚ ğŸ” ELASTICSEARCHâ”‚ â”ƒ
â”ƒ  â”‚    (v16)     â”‚  â”‚   (v7)       â”‚  â”‚  (v7.5)      â”‚  â”‚     (v8.11)     â”‚ â”ƒ
â”ƒ  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚                 â”‚ â”ƒ
â”ƒ  â”‚â€¢ auth_db     â”‚  â”‚â€¢ Sessions    â”‚  â”‚â€¢ Event       â”‚  â”‚â€¢ Full-text      â”‚ â”ƒ
â”ƒ  â”‚â€¢ org_db      â”‚  â”‚â€¢ Caching     â”‚  â”‚  Streaming   â”‚  â”‚  Search         â”‚ â”ƒ
â”ƒ  â”‚â€¢ permission  â”‚  â”‚â€¢ Rate Limits â”‚  â”‚â€¢ Topics:     â”‚  â”‚â€¢ Analytics      â”‚ â”ƒ
â”ƒ  â”‚â€¢ billing_db  â”‚  â”‚â€¢ Token Store â”‚  â”‚  auth.events â”‚  â”‚  Indexing       â”‚ â”ƒ
â”ƒ  â”‚â€¢ audit_db    â”‚  â”‚              â”‚  â”‚  org.events  â”‚  â”‚                 â”‚ â”ƒ
â”ƒ  â”‚â€¢ admin_panel â”‚  â”‚              â”‚  â”‚  ...         â”‚  â”‚                 â”‚ â”ƒ
â”ƒ  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚                 â”‚ â”ƒ
â”ƒ  â”‚ Port: 5433   â”‚  â”‚ Port: 6379   â”‚  â”‚ Port: 9092   â”‚  â”‚ Port: 9200      â”‚ â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”ƒ
â”ƒ                                                                               â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”ƒ
â”ƒ  â”‚  ğŸ“§ MAILHOG  â”‚  â”‚ ğŸ›ï¸ KAFKA-UI  â”‚  (Dev Tools)                            â”ƒ
â”ƒ  â”‚SMTP: 1025    â”‚  â”‚Port: 8080    â”‚                                          â”ƒ
â”ƒ  â”‚Web:  8025    â”‚  â”‚              â”‚                                          â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
```

---

## **ğŸ”„ SERVICE-TO-SERVICE INTERACTION FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     COMPLETE REQUEST FLOW                                    â”‚
â”‚          Example: "User Sarah logs in and views contacts"                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ‘¤ CLIENT                                                    ğŸ“± RESPONSE
    â”‚                                                              â–²
    â”‚ 1. POST /auth/login                                         â”‚
    â”‚    {email, password, mfa_code}                              â”‚
    â–¼                                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸšª API GATEWAY                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âœ“ Check rate limit (100 req/min)                             â”‚
â”‚  âœ“ Generate X-Request-ID: abc-123                             â”‚
â”‚  âœ“ Log request                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ 2. HMAC Sign Request
             â”‚    X-Gateway-Signature: [HMAC-SHA256]
             â”‚    X-Gateway-Timestamp: 1706636400
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” AUTH SERVICE                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âœ“ Verify HMAC signature                                       â”‚
â”‚  âœ“ Check password (Argon2)                                     â”‚
â”‚  âœ“ Validate MFA code (TOTP)                                    â”‚
â”‚  âœ“ Create session                                              â”‚
â”‚  âœ“ Generate JWT token                                          â”‚
â”‚  âœ“ Publish event: user.logged_in                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  DB Write: auth_db.sessions                                    â”‚
â”‚  Kafka Publish: auth.user.events â†’ "user.logged_in"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ 3. Return JWT
             â”‚    {access_token, refresh_token}
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸšª GATEWAY                                                     â”‚
â”‚  Returns: {access_token, refresh_token, user_info}            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 4. Client stores JWT
             â–¼
  ğŸ‘¤ CLIENT now has JWT token
    â”‚
    â”‚ 5. GET /org/api/organizations/acme-corp/members
    â”‚    Authorization: Bearer [JWT]
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸšª API GATEWAY                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âœ“ Verify JWT signature                                        â”‚
â”‚  âœ“ Extract: user_id, org_id, roles, permissions               â”‚
â”‚  âœ“ Check rate limit                                            â”‚
â”‚  âœ“ Validate org membership                                     â”‚
â”‚  âœ“ HMAC sign for backend                                       â”‚
â”‚  âœ“ Inject headers:                                             â”‚
â”‚     X-User-Id: user-123                                        â”‚
â”‚     X-Org-Id: org-456                                          â”‚
â”‚     X-User-Roles: admin,sales_manager                          â”‚
â”‚     X-User-Permissions: members:read,members:write             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ 6. Route to Org Service
             â”‚    HMAC Signed Request
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ›ï¸ ORG SERVICE                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âœ“ Verify HMAC signature                                       â”‚
â”‚  âœ“ Trust gateway headers (Zero Trust verified)                â”‚
â”‚  âœ“ Check permission: members:read                              â”‚
â”‚  âœ“ Query database: org_members WHERE org_id = 'org-456'       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  DB Read: org_db.organization_members                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âœ“ FOR EACH MEMBER: Call Auth Service for user details        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ 7. Internal Service Call
             â”‚    POST http://auth-service:8000/internal/users/bulk
             â”‚    X-Service-Name: org-service
             â”‚    X-Service-Signature: [HMAC with SERVICE_SECRET]
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” AUTH SERVICE (Internal API)                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âœ“ Verify service signature                                    â”‚
â”‚  âœ“ Return user details (email, name, status)                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  DB Read: auth_db.users                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ 8. Return user data
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ›ï¸ ORG SERVICE                                                 â”‚
â”‚  Combine: org_members + user_details                           â”‚
â”‚  Publish event: members.listed                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Kafka Publish: org.member.events â†’ "members.listed"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ 9. Return response
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸšª GATEWAY                                                     â”‚
â”‚  Forward response to client                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ 10. JSON Response
             â–¼
  ğŸ‘¤ CLIENT receives list of members
    â”‚
    â”‚ (Meanwhile, asynchronously...)
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¨ KAFKA                                                       â”‚
â”‚  Topics:                                                        â”‚
â”‚  â€¢ auth.user.events:   "user.logged_in"                        â”‚
â”‚  â€¢ org.member.events:  "members.listed"                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚              â”‚
           â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ“‹ AUDIT-LOG â”‚  â”‚ ğŸ“Š ANALYTICSâ”‚
    â”‚   SERVICE   â”‚  â”‚   SERVICE   â”‚
    â”‚             â”‚  â”‚             â”‚
    â”‚ Stores:     â”‚  â”‚ Updates:    â”‚
    â”‚ â€¢ Who: Sarahâ”‚  â”‚ â€¢ Login     â”‚
    â”‚ â€¢ What:     â”‚  â”‚   count     â”‚
    â”‚   Logged in â”‚  â”‚ â€¢ Active    â”‚
    â”‚ â€¢ When:     â”‚  â”‚   users     â”‚
    â”‚   12:00 PM  â”‚  â”‚ â€¢ Dashboard â”‚
    â”‚ â€¢ IP: xxx   â”‚  â”‚   metrics   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **ğŸ” SECURITY MECHANISMS**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECURITY LAYERS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: CLIENT â†’ GATEWAY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â€¢ JWT Bearer Token (HS256)
 â€¢ Rate Limiting: 100 req/min per user
 â€¢ CORS validation
 â€¢ Request ID tracing

Layer 2: GATEWAY â†’ SERVICES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â€¢ HMAC-SHA256 request signing
 â€¢ Cryptographic signature: HMAC(gateway_secret, timestamp|path|body)
 â€¢ Signed headers injected:
   - X-Gateway-Timestamp
   - X-Gateway-Signature
   - X-User-Id
   - X-Org-Id
   - X-User-Roles
   - X-User-Permissions

Layer 3: SERVICE â†’ SERVICE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â€¢ Service-to-service HMAC signing
 â€¢ Each service has unique SECRET
 â€¢ Headers:
   - X-Service-Name: "org-service"
   - X-Service-Signature: HMAC(service_secret, payload)

Layer 4: DATA ACCESS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â€¢ Database-per-service pattern
 â€¢ Multi-tenancy: org_id filter on ALL queries
 â€¢ Row-level security (RLS)
 â€¢ Encrypted at rest

Layer 5: AUDIT & COMPLIANCE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â€¢ Every action logged to Kafka
 â€¢ Immutable audit logs
 â€¢ Compliance trail: WHO, WHAT, WHEN, WHERE

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             JWT TOKEN STRUCTURE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                                             â”‚
â”‚   "sub": "user-uuid",          // User ID                    â”‚
â”‚   "email": "sarah@acme.com",   // Email                      â”‚
â”‚   "org_id": "org-uuid",        // Organization ID            â”‚
â”‚   "org_slug": "acme-corp",     // URL-friendly org name      â”‚
â”‚   "org_name": "Acme Corp",     // Display name               â”‚
â”‚   "roles": [                   // User's roles               â”‚
â”‚     "admin",                                                  â”‚
â”‚     "sales_manager"                                           â”‚
â”‚   ],                                                          â”‚
â”‚   "permissions": [             // Flattened permissions      â”‚
â”‚     "contacts:read",                                          â”‚
â”‚     "contacts:write",                                         â”‚
â”‚     "deals:read"                                              â”‚
â”‚   ],                                                          â”‚
â”‚   "plan": "pro",               // Subscription plan          â”‚
â”‚   "session_id": "sess-uuid",   // Session tracking           â”‚
â”‚   "iss": "truevalue-auth",     // Issuer                     â”‚
â”‚   "aud": "truevalue-platform", // Audience                   â”‚
â”‚   "exp": 1706640000,           // Expires (15 min)           â”‚
â”‚   "iat": 1706636400            // Issued at                  â”‚
â”‚ }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **ğŸ“Š DATA FLOW & EVENT ARCHITECTURE**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EVENT-DRIVEN ARCHITECTURE                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SYNCHRONOUS FLOW (Request/Response):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 Client â†’ Gateway â†’ Service â†’ Database â†’ Service â†’ Gateway â†’ Client
         â†“         â†“          â†“
      (Validate) (Process)  (Store)


ASYNCHRONOUS FLOW (Event-Driven):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 Service â†’ Kafka Topic â†’ Multiple Consumers
    â†“
  (Publish CloudEvent)
    â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Event: user.registered       â”‚
  â”‚ Source: /auth-service        â”‚
  â”‚ Data: {user_id, email, ...} â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
  Kafka Broker (Persistent Storage)
    â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Consumers (Fan-out pattern):                â”‚
  â”‚ â€¢ Audit-Log Service â†’ Store immutable log   â”‚
  â”‚ â€¢ Analytics Service â†’ Update metrics        â”‚
  â”‚ â€¢ Email Service     â†’ Send welcome email    â”‚
  â”‚ â€¢ Future Services   â†’ Custom processing     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KAFKA TOPICS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â€¢ auth.user.events          â†’ User lifecycle events
 â€¢ org.member.events         â†’ Membership changes
 â€¢ org.organization.events   â†’ Org CRUD events
 â€¢ billing.subscription.events â†’ Billing changes
 â€¢ permission.role.events    â†’ Permission changes

DATABASE PER SERVICE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚   auth_db   â”‚  â”‚   org_db    â”‚  â”‚permission_dbâ”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚â€¢ users      â”‚  â”‚â€¢ orgs       â”‚  â”‚â€¢ roles      â”‚
 â”‚â€¢ sessions   â”‚  â”‚â€¢ members    â”‚  â”‚â€¢ permissionsâ”‚
 â”‚â€¢ mfa_methodsâ”‚  â”‚â€¢ teams      â”‚  â”‚â€¢ assignmentsâ”‚
 â”‚â€¢ refresh_   â”‚  â”‚â€¢ invites    â”‚  â”‚â€¢ policies   â”‚
 â”‚  tokens     â”‚  â”‚â€¢ profiles   â”‚  â”‚             â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²                â–²                â–²
       â”‚                â”‚                â”‚
     (owns)           (owns)           (owns)
       â”‚                â”‚                â”‚
 Auth Service    Org Service    Permission Service

NO DIRECT DATABASE ACCESS BETWEEN SERVICES!
Services communicate via:
 1. REST API calls (synchronous)
 2. Kafka events (asynchronous)
```

---

## **ğŸ¯ KEY FEATURES & CAPABILITIES**

**1. MULTI-TENANCY (Organization Isolation)**
```
Organization A          Organization B
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ users: 50    â”‚   âŒ  â”‚ users: 100   â”‚
â”‚ contacts: 200â”‚  â—„â”€â”€â–º â”‚ contacts: 500â”‚
â”‚ deals: 30    â”‚   âŒ  â”‚ deals: 80    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Complete Isolation via org_id filter
```

**2. ROLE-BASED ACCESS CONTROL (RBAC)**
```
Admin    â†’ All permissions
Manager  â†’ Team permissions
Member   â†’ Own data + shared
Viewer   â†’ Read-only

Permission format: "resource:action"
Examples: contacts:read, contacts:write, deals:delete
```

**3. AUTHENTICATION & SECURITY**
- JWT tokens (15-min access, 7-day refresh)
- MFA support (TOTP, WebAuthn, SMS, Email)
- Account locking after 5 failed attempts
- Password policy enforcement
- Session management with device tracking

**4. BILLING & SUBSCRIPTIONS**
- Multiple plans (Free, Pro, Enterprise)
- Usage-based billing
- Payment processing (Stripe/Razorpay)
- Automated invoicing

**5. AUDIT & COMPLIANCE**
- Immutable audit logs
- WHO did WHAT, WHEN, WHERE
- Compliance ready (GDPR, SOC2)

---

## **ğŸ› ï¸ TECHNOLOGY STACK**

```
Frontend (Future):
 â€¢ Next.js 14 (React SSR)
 â€¢ TailwindCSS
 â€¢ shadcn/ui components

API Gateway:
 â€¢ FastAPI (Python 3.12)
 â€¢ uvicorn ASGI server
 â€¢ Redis for rate limiting

Backend Services:
 â€¢ Django 5.2
 â€¢ Django REST Framework 3.16
 â€¢ Python 3.12

Databases:
 â€¢ PostgreSQL 16 (Primary)
 â€¢ Redis 7 (Cache, Sessions, Rate Limits)

Message Queue:
 â€¢ Apache Kafka 7.5.0
 â€¢ CloudEvents format

Search:
 â€¢ Elasticsearch 8.11

Containers:
 â€¢ Docker
 â€¢ docker-compose

Security:
 â€¢ Argon2 (password hashing)
 â€¢ JWT (HS256)
 â€¢ HMAC-SHA256 (request signing)
 â€¢ TOTP (2FA)
```

---

## **ğŸ“ˆ PROJECT METRICS**

```
Services:        7 active + 1 analytics
Databases:       6 separate DBs
API Endpoints:   ~50+ (across all services)
Network Layers:  3 (Public, Internal, Infrastructure)
Security Layers: 6 (JWT â†’ HMAC â†’ Service Auth â†’ Data â†’ Audit)
Event Topics:    5+ Kafka topics
```

---

## **ğŸš€ DEPLOYMENT ARCHITECTURE**

```
Development:
 â€¢ Docker Compose
 â€¢ Local PostgreSQL on port 5433
 â€¢ All services in containers
 â€¢ Hot reload enabled

Production (Future):
 â€¢ Kubernetes cluster
 â€¢ Managed PostgreSQL (RDS/CloudSQL)
 â€¢ Managed Redis (ElastiCache/MemoryStore)
 â€¢ Managed Kafka (Confluent Cloud/MSK)
 â€¢ Load balancer â†’ Gateway
 â€¢ Horizontal scaling
 â€¢ Health checks & auto-recovery
```

---

This is a **professional, enterprise-grade microservices platform** with:
- âœ… Zero Trust security
- âœ… Multi-tenant SaaS architecture
- âœ… Event-driven design
- âœ… Database-per-service isolation
- âœ… Comprehensive audit trail
- âœ… Scalable & maintainable
